<!DOCTYPE html>

<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
      #info {
        position: absolute;
        width:20%;
        height:100%;
        bottom:0px;
        right:0px;
        top:0px;
        background-color: white;
        border-left:1px #666 solid;
        font-family:Helvetica;
      }
      #info div {
        padding:0px;
        padding-left:10px;
        margin:0px;
      }
      #info div h1 {
        margin-top:10px;
        font-size:16px;
      }
      #info div p {
        font-size:14px;
        color:#333;
      }
    </style>
	<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
    
  </head>
  <body>
    <div id="map_canvas"></div>
<script type="text/javascript">
		var today = new Date();
		// Use JavaScript to get the date a week ago
		var priorDate = new Date().setDate(today.getDate() - 7);
		// Set that to an ISO8601 timestamp as required by the USGS earthquake API
		var priorDateTs = new Date(priorDate);
		var sevenDaysAgo = priorDateTs.toISOString();
		
		
		mapboxgl.accessToken = 'pk.yOuNeEdtOGEtyOuRowNkeY';
        var mapOptions = {
			container: 'map_canvas',
            center:  [8.62, 47.24],
            zoom: 10,
            style: 'mapbox://styles/mapbox/streets-v11'
        }
        var map = new mapboxgl.Map(mapOptions);
			map.on('load',function() {
			map.addSource('planes', {
					'type': 'geojson',
					'data': '/data/data.json',
					'generateId': true 
				  });
			map.addLayer({
					'id': 'planes-viz',
					'type': 'circle',
					'source': 'planes',
					'paint': {
					'circle-stroke-color': '#ff0000',
					'circle-stroke-width': 2,
					'circle-radius': 12,
					'circle-color': '#ff0000'
				  }
					});
		});
		var hexDisplay = document.getElementById('hex');
		var flightDisplay = document.getElementById('flight');
		var altitudeDisplay = document.getElementById('altitude');
		
		var planeID = null;
		map.on('mousemove', 'planes-viz', (e) => {
		  map.getCanvas().style.cursor = 'pointer';
		  // Set variables equal to the current feature's magnitude, location, and time
		  var planeHex = e.features[0].properties.hex;
		  var planeFlight = e.features[0].properties.flight;
		  var planeAltitude = e.features[0].properties.altitude;

		  // Check whether features exist
		  if (e.features.length > 0) {
			// Display the magnitude, location, and time in the sidebar
			hexDisplay.textContent = planeHex;
			flightDisplay.textContent = planeFlight;
			altitudeDisplay.textContent = planeAltitude;

			// If quakeID for the hovered feature is not null,
			// use removeFeatureState to reset to the default behavior
			if (planeID) {
			  map.removeFeatureState({
				source: "planes",
				id: planeID
			  });
			}
			planeID = e.features[0].id;

			// When the mouse moves over the earthquakes-viz layer, update the
			// feature state for the feature under the mouse
			map.setFeatureState({
			  source: 'planes',
			  id: planeID,
			}, {
			  hover: true
			});

		  }
		});
		map.on('mouseleave', 'planes-viz', function() {
		  if (planeID) {
			map.setFeatureState({
			  source: 'planes',
			  id: planeID
			}, {
			  hover: false
			});
		  }
		  
		  planeID = null;
		  // Remove the information from the previously hovered feature from the sidebar
		  hexDisplay.textContent = '';
		  flightDisplay.textContent = '';
		  altitudeDisplay.textContent = '';
		  // Reset the cursor style
		  map.getCanvas().style.cursor = '';
		});

</script>
    <div id="info">
        <h1>Planes Nearby</h1>
        <p id="geninfo"></p>
        <div class='planeinfo' id='planeinfo'>
			<div><strong>Hex:</strong> <span id='hex'></span></div>
			<div><strong>Flight:</strong> <span id='flight'></span></div>
			<div><strong>Altitude:</strong> <span id='altitude'></span></div>
		</div>
    </div>
  </body>
</html>
